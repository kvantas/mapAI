<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced Analysis with Swiss Data • mapAI</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Analysis with Swiss Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mapAI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/demo_data.html">Getting Started with mapAI: A Complete Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/pai_validation.html">Comparing PAI Methods and Validation Strategies</a></li>
    <li><a class="dropdown-item" href="../articles/swiss_data.html">Advanced Analysis with Swiss Data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Advanced Analysis with Swiss Data</h1>
            
      

      <div class="d-none name"><code>swiss_data.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates a workflow for analyzing and correcting a
historical map with complex, non-linear distortions. While the
<code>Getting Started</code> vignette used a synthetic data set, this
one focuses on a more challenging real-world scenario using the
<code>swiss_cps</code> dataset.</p>
<p>The key feature of this dataset is that the gross, linear distortions
have already been removed with a Helmert transformation. The remaining
errors are subtle, non-linear, and spatially variable. Our goal is to
assess different validation techniques, train a robust model for these
non-linear residuals, and conduct an in-depth analysis of the spatial
distortion.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>First, we load all the necessary libraries for our workflow.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the necessary libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kvantas.github.io/mapAI/">mapAI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="initial-data-analysis">Initial Data Analysis<a class="anchor" aria-label="anchor" href="#initial-data-analysis"></a>
</h3>
<p>We begin by loading the <code>swiss_cps</code> dataset. This
<code>sf</code> object contains 343 control points where the
<code>source</code> coordinates have been pre-aligned, so we can focus
on the residual <code>dx</code> and <code>dy</code> errors.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the built-in Swiss control points dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">swiss_cps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the data structure</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">swiss_cps</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 343</span></span>
<span><span class="co">#&gt; Columns: 8</span></span>
<span><span class="co">#&gt; $ Index    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>5<span style="color: #949494;">, </span>6<span style="color: #949494;">, </span>7<span style="color: #949494;">, </span>8<span style="color: #949494;">, </span>9<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>11<span style="color: #949494;">, </span>12<span style="color: #949494;">, </span>13<span style="color: #949494;">, </span>14<span style="color: #949494;">, </span>15<span style="color: #949494;">, </span>16<span style="color: #949494;">, </span>17<span style="color: #949494;">, </span>18…</span></span>
<span><span class="co">#&gt; $ source_x <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 612293.0<span style="color: #949494;">, </span>612225.0<span style="color: #949494;">, </span>615470.3<span style="color: #949494;">, </span>616339.8<span style="color: #949494;">, </span>616927.1<span style="color: #949494;">, </span>617571.9<span style="color: #949494;">, </span>6…</span></span>
<span><span class="co">#&gt; $ source_y <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 267353.6<span style="color: #949494;">, </span>270412.7<span style="color: #949494;">, </span>270195.1<span style="color: #949494;">, </span>269367.5<span style="color: #949494;">, </span>269507.6<span style="color: #949494;">, </span>269273.5<span style="color: #949494;">, </span>2…</span></span>
<span><span class="co">#&gt; $ target_x <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 611375.9<span style="color: #949494;">, </span>611573.1<span style="color: #949494;">, </span>615840.8<span style="color: #949494;">, </span>616129.6<span style="color: #949494;">, </span>617031.0<span style="color: #949494;">, </span>618168.7<span style="color: #949494;">, </span>6…</span></span>
<span><span class="co">#&gt; $ target_y <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 267719.1<span style="color: #949494;">, </span>270370.6<span style="color: #949494;">, </span>270463.6<span style="color: #949494;">, </span>269380.6<span style="color: #949494;">, </span>268932.1<span style="color: #949494;">, </span>269179.3<span style="color: #949494;">, </span>2…</span></span>
<span><span class="co">#&gt; $ dx       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -917.1063<span style="color: #949494;">, </span>-651.9320<span style="color: #949494;">, </span>370.4737<span style="color: #949494;">, </span>-210.1946<span style="color: #949494;">, </span>103.8862<span style="color: #949494;">, </span>596.7662…</span></span>
<span><span class="co">#&gt; $ dy       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 365.468249<span style="color: #949494;">, </span>-42.050863<span style="color: #949494;">, </span>268.478200<span style="color: #949494;">, </span>13.144895<span style="color: #949494;">, </span>-575.530782<span style="color: #949494;">, </span>-…</span></span>
<span><span class="co">#&gt; $ geometry <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span> POINT (612293 267353.6)<span style="color: #949494;">, </span>POINT (612225 270412.7)<span style="color: #949494;">, </span>POINT…</span></span>
<span></span>
<span><span class="co"># Visualize the residual displacement vectors</span></span>
<span><span class="fu"><a href="../reference/plot_displacement.html">plot_displacement</a></span><span class="op">(</span><span class="va">swiss_cps</span>, title <span class="op">=</span> <span class="st">"Displacement Vectors"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, subtitle <span class="op">=</span> <span class="st">""</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"x (m)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"y (m)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/sw_load-data-1.png" width="100%"></p>
<p>The plot shows clear spatial patterns in the remaining errors, which
a simple linear model could not fix. This confirms the need for a
non-linear approach.</p>
</div>
<div class="section level3">
<h3 id="error-assessment-and-model-validation">Error Assessment and Model Validation<a class="anchor" aria-label="anchor" href="#error-assessment-and-model-validation"></a>
</h3>
<p>Before training a final model, it is crucial to assess its expected
performance. The <code>assess_pai_model</code> function provides a
robust framework for this. We will compare four different validation
strategies to understand how the model might perform on new data.</p>
<ul>
<li>
<strong>Standard &amp; Spatial Cross-Validation</strong>: We test a
10-fold cross-validation, once with random data splits and once with
“spatial” splits, which ensures that training and validation sets are
spatially separated.</li>
<li>
<strong>Design-Based Validation</strong>: We also test validation
based on sampling probability (<code>probability</code>) and stratified
random sampling (<code>stratified</code>), which are useful when the
data points have a known design or structure.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run four different validation methods using a GAM</span></span>
<span><span class="va">cvra</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assess_pai_model.html">assess_pai_model</a></span><span class="op">(</span><span class="va">swiss_cps</span>, pai_method <span class="op">=</span> <span class="st">"gam"</span>, validation_type <span class="op">=</span> <span class="st">"random"</span>, k_folds <span class="op">=</span> <span class="fl">10</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">cvsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assess_pai_model.html">assess_pai_model</a></span><span class="op">(</span><span class="va">swiss_cps</span>, pai_method <span class="op">=</span> <span class="st">"gam"</span>, validation_type <span class="op">=</span> <span class="st">"spatial"</span>, k_folds <span class="op">=</span> <span class="fl">10</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">valr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assess_pai_model.html">assess_pai_model</a></span><span class="op">(</span><span class="va">swiss_cps</span>, pai_method <span class="op">=</span> <span class="st">"gam"</span>, validation_type <span class="op">=</span> <span class="st">"probability"</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assess_pai_model.html">assess_pai_model</a></span><span class="op">(</span><span class="va">swiss_cps</span>, pai_method <span class="op">=</span> <span class="st">"gam"</span>, validation_type <span class="op">=</span> <span class="st">"stratified"</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine and format the results into a table</span></span>
<span><span class="va">validation_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">cvra</span>, <span class="va">cvsp</span>, <span class="va">valr</span>, <span class="va">vals</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>Model_Method <span class="op">=</span> <span class="va">Method</span>, Mean_2D_RMSE_m <span class="op">=</span> <span class="va">Mean_RMSE_2D</span>, Std_Deviation_of_RMSE_m <span class="op">=</span> <span class="va">SD_RMSE_2D</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">validation_df</span><span class="op">$</span><span class="va">type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Standard 10-fold cross-validation"</span>,</span>
<span>                       <span class="st">"Spatial 10-fold cross-validation"</span>,</span>
<span>                       <span class="st">"Design-based validation"</span>,</span>
<span>                       <span class="st">"Design-based validation using stratified random sampling"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the comparison table</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">validation_df</span>, caption <span class="op">=</span> <span class="st">"Table: Validation performance across different assessment methods."</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Table: Validation performance across different assessment
methods.</caption>
<colgroup>
<col width="11%">
<col width="13%">
<col width="22%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th align="left">Model_Method</th>
<th align="right">Mean_2D_RMSE_m</th>
<th align="right">Std_Deviation_of_RMSE_m</th>
<th align="left">type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">gam</td>
<td align="right">778.6</td>
<td align="right">176.8</td>
<td align="left">Standard 10-fold cross-validation</td>
</tr>
<tr class="even">
<td align="left">gam</td>
<td align="right">1254.8</td>
<td align="right">796.7</td>
<td align="left">Spatial 10-fold cross-validation</td>
</tr>
<tr class="odd">
<td align="left">gam</td>
<td align="right">876.7</td>
<td align="right">NA</td>
<td align="left">Design-based validation</td>
</tr>
<tr class="even">
<td align="left">gam</td>
<td align="right">702.3</td>
<td align="right">NA</td>
<td align="left">Design-based validation using stratified random
sampling</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="final-correction-and-visualization">Final Correction and Visualization<a class="anchor" aria-label="anchor" href="#final-correction-and-visualization"></a>
</h3>
<p>Now, confident in our modeling choice, we train a final
<strong>Generalized Additive Model (<code>gam</code>)</strong> on the
entire dataset. To visualize the effect of the correction, we will apply
this model to a regular reference grid.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Train the final GAM model on all data points</span></span>
<span><span class="va">final_gam_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_pai_model.html">train_pai_model</a></span><span class="op">(</span><span class="va">swiss_cps</span>, pai_method <span class="op">=</span> <span class="st">"gam"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Training 'gam' model...</span></span>
<span></span>
<span><span class="co"># Create a regular line grid to serve as our reference map</span></span>
<span><span class="va">source_grid</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span><span class="va">swiss_cps</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"MULTILINESTRING"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply the trained model to correct the grid</span></span>
<span><span class="va">gam_corrected_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_pai_model.html">apply_pai_model</a></span><span class="op">(</span><span class="va">final_gam_model</span>, <span class="va">source_grid</span><span class="op">)</span></span>
<span><span class="co">#&gt; Applying PAI model to map features...</span></span>
<span><span class="co">#&gt; Correction complete.</span></span>
<span></span>
<span><span class="co"># Prepare data for plotting</span></span>
<span><span class="va">source_grid</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="st">"Original (Distorted)"</span></span>
<span><span class="va">gam_corrected_grid</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="st">"GAM"</span></span>
<span><span class="va">comparison_data</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">source_grid</span><span class="op">[</span>, <span class="st">"status"</span><span class="op">]</span>, <span class="va">gam_corrected_grid</span><span class="op">[</span>, <span class="st">"status"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the comparison plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">comparison_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">status</span>, linetype <span class="op">=</span> <span class="va">status</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Map Status"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original (Distorted)"</span> <span class="op">=</span> <span class="st">"grey50"</span>, <span class="st">"GAM"</span> <span class="op">=</span> <span class="st">"#e41a1c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">swiss_cps</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">source_x</span>, <span class="va">source_y</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Map Status"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original (Distorted)"</span> <span class="op">=</span> <span class="st">"dashed"</span>, <span class="st">"GAM"</span> <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"x (m)"</span>, y <span class="op">=</span> <span class="st">"y (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">21781</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/sw_trainmodel-1.png" width="100%"></p>
<p>The plot shows how the regular grid (dashed grey) is warped by the
model into the corrected grid (solid red). This transformation is
precisely what’s needed to align the distorted map features with their
true locations.</p>
</div>
<div class="section level3">
<h3 id="residual-analysis">Residual Analysis<a class="anchor" aria-label="anchor" href="#residual-analysis"></a>
</h3>
<p>After applying the correction, we should examine the remaining
errors, or residuals. This helps us confirm that our model has captured
the systematic distortion patterns and that the remaining errors are
small and random.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the residuals after applying the final GAM model</span></span>
<span><span class="fu"><a href="../reference/plot_residuals.html">plot_residuals</a></span><span class="op">(</span><span class="va">final_gam_model</span>, <span class="va">swiss_cps</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">""</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">""</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"x (m)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"y (m)"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Calculating model residuals...</span></span></code></pre></div>
<p><img src="reference/figures/sw_residuals-1.png" width="100%"></p>
<p>The residual vectors are much smaller and show no obvious spatial
pattern, indicating a successful model fit.</p>
</div>
<div class="section level3">
<h3 id="advanced-distortion-analysis">Advanced Distortion Analysis<a class="anchor" aria-label="anchor" href="#advanced-distortion-analysis"></a>
</h3>
<p>To quantify the nature of the distortion, we use the
<code>analyze_distortion</code> function on a dense grid of points. This
allows us to map out different distortion metrics across the entire
area. We will visualize three key metrics:</p>
<ul>
<li>
<strong>Area Scale</strong>: Shows how much areas are stretched or
compressed. A value of 1 means no distortion.</li>
<li>
<strong>Maximum Angular Distortion</strong>: Measures the maximum
change in angle at any point.</li>
<li>
<strong>Airy-Kavrayskiy Measure</strong>: A combined measure of both
areal and angular distortion.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a dense grid of points for a high-resolution analysis</span></span>
<span><span class="va">analysis_points</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span><span class="va">swiss_cps</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">distortion_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyze_distortion.html">analyze_distortion</a></span><span class="op">(</span><span class="va">final_gam_model</span>, <span class="va">analysis_points</span><span class="op">)</span></span>
<span><span class="co">#&gt; Calculating distortion metrics for gam model...</span></span>
<span><span class="co">#&gt; Finalizing metrics from derivatives...</span></span>
<span><span class="co">#&gt; Distortion analysis complete.</span></span>
<span></span>
<span><span class="co"># Plot 1: Area scale distortion</span></span>
<span><span class="fu"><a href="../reference/plot_distortion_surface.html">plot_distortion_surface</a></span><span class="op">(</span><span class="va">distortion_results</span>, <span class="st">"area_scale"</span>, diverging <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Area Scale Distortion"</span>, subtitle <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"x (m)"</span>, y <span class="op">=</span> <span class="st">"y (m)"</span>, fill <span class="op">=</span> <span class="st">'σ'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regular grid detected. Creating a surface plot with geom_raster().</span></span>
<span><span class="co">#&gt; Warning: Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">#&gt; Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span></code></pre></div>
<p><img src="reference/figures/sw_distortions-1.png" width="100%"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot 2: Maximum angular distortion</span></span>
<span><span class="fu"><a href="../reference/plot_distortion_surface.html">plot_distortion_surface</a></span><span class="op">(</span><span class="va">distortion_results</span>, <span class="st">"max_angular_distortion"</span>, palette <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Maximum Angular Distortion"</span>, subtitle <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"x (m)"</span>, y <span class="op">=</span> <span class="st">"y (m)"</span>, fill <span class="op">=</span> <span class="st">"2Ω (rad)"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regular grid detected. Creating a surface plot with geom_raster().</span></span>
<span><span class="co">#&gt; Warning: Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">#&gt; Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span></code></pre></div>
<p><img src="reference/figures/sw_distortions-2.png" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot 3: Airy-Kavrayskiy distortion measure</span></span>
<span><span class="fu"><a href="../reference/plot_distortion_surface.html">plot_distortion_surface</a></span><span class="op">(</span><span class="va">distortion_results</span>, <span class="st">"airy_kavrayskiy"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Airy-Kavrayskiy Combined Distortion"</span>, subtitle <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"x (m)"</span>, y <span class="op">=</span> <span class="st">"y (m)"</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">E</span><span class="op">[</span><span class="st">"AK"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regular grid detected. Creating a surface plot with geom_raster().</span></span>
<span><span class="co">#&gt; Warning: Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">#&gt; Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span></code></pre></div>
<p><img src="reference/figures/sw_distortions-3.png" width="100%"></p>
<p>We can also summarize these distortion metrics numerically.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate and print summary statistics for the distortion metrics</span></span>
<span><span class="va">summary_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">distortion_results</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>    Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Areal Scale"</span>, <span class="st">"Max Angular Distortion (rad)"</span>, <span class="st">"Airy-Kavrayskiy Measure"</span><span class="op">)</span>,</span>
<span>    Minimum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">area_scale</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">max_angular_distortion</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">airy_kavrayskiy</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">area_scale</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">max_angular_distortion</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">airy_kavrayskiy</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    Maximum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">area_scale</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">max_angular_distortion</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">airy_kavrayskiy</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">summary_stats</span>, caption <span class="op">=</span> <span class="st">"Table: Summary of distortion metrics from GAM model analysis."</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Table: Summary of distortion metrics from GAM model analysis.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |Metric                       | Minimum| Mean| Maximum|</span></span>
<span><span class="co">#&gt; |:----------------------------|-------:|----:|-------:|</span></span>
<span><span class="co">#&gt; |Areal Scale                  |    0.45| 0.87|    1.41|</span></span>
<span><span class="co">#&gt; |Max Angular Distortion (rad) |    0.00| 0.21|    0.86|</span></span>
<span><span class="co">#&gt; |Airy-Kavrayskiy Measure      |    0.00| 0.04|    0.28|</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-distortion-with-indicatrices">Visualizing Distortion with Indicatrices<a class="anchor" aria-label="anchor" href="#visualizing-distortion-with-indicatrices"></a>
</h3>
<p>A classic way to visualize map distortion is with <strong>Tissot’s
Indicatrix</strong>, which shows how an infinitesimal circle on the
original surface is deformed into an ellipse. We can plot these at our
control point locations to see the local distortion characteristics.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analyze distortion specifically at the control point locations</span></span>
<span><span class="va">distortion_at_gcps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyze_distortion.html">analyze_distortion</a></span><span class="op">(</span><span class="va">final_gam_model</span>, points_to_analyze <span class="op">=</span> <span class="va">swiss_cps</span><span class="op">)</span></span>
<span><span class="co">#&gt; Calculating distortion metrics for gam model...</span></span>
<span><span class="co">#&gt; Finalizing metrics from derivatives...</span></span>
<span><span class="co">#&gt; Distortion analysis complete.</span></span>
<span></span>
<span><span class="co"># Plot the indicatrices (ellipses) at each point</span></span>
<span><span class="fu"><a href="../reference/plot_indicatrices.html">plot_indicatrices</a></span><span class="op">(</span><span class="va">distortion_at_gcps</span>,  scale_factor <span class="op">=</span> <span class="fl">700</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Distortion Indicatrices at Control Points"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">""</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"x (m)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"y (m)"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Generating indicatrix polygons at source locations...</span></span></code></pre></div>
<p><img src="reference/figures/sw_indicatrices-1.png" width="100%"></p>
<p>The size and shape of the ellipses clearly show the spatial variation
in both the magnitude and direction of the distortion that our model has
successfully captured.</p>
<p>This vignette has demonstrated a comprehensive workflow for a
complex, real-world PAI task. By combining robust validation, non-linear
modeling, and advanced distortion analysis, <code>mapAI</code> provides
a powerful toolkit for any historical map correction project.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Konstantinos Vantas.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
