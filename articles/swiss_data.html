<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Analysis with Swiss Data • mapAI</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Analysis with Swiss Data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapAI</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/demo_data.html">Getting Started with mapAI: A Complete Workflow</a>
    </li>
    <li>
      <a href="../articles/pai_validation.html">Comparing PAI Methods and Validation Strategies</a>
    </li>
    <li>
      <a href="../articles/swiss_data.html">Advanced Analysis with Swiss Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Advanced Analysis with Swiss Data</h1>
            
      

      <div class="hidden name"><code>swiss_data.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates an advanced workflow for analyzing and
correcting a map with complex, non-linear distortions. While the first
vignette showed a general correction, this one focuses on a more
challenging real-world scenario.</p>
<p>We will use the <code>swiss_cps</code> dataset, which is included
with the <code>mapAI</code> package. The key feature of this dataset is
that the gross, linear distortions have already been removed with a
Helmert transformation. The remaining errors are subtle, non-linear, and
spatially variable—a perfect test case for the more advanced models in
<code>mapAI</code>.</p>
<p>Our goal is to model these non-linear residuals and visualize the
effect of the correction on a reference line grid.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the necessary libraries for our workflow</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mapAI</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span> <span class="co"># For the %&gt;% pipe operator</span></span></code></pre></div>
<div class="section level2">
<h2 id="step-1-load-and-explore-the-data">Step 1: Load and Explore the Data<a class="anchor" aria-label="anchor" href="#step-1-load-and-explore-the-data"></a>
</h2>
<p>We begin by loading the <code>swiss_cps</code> dataset. This
<code>sf</code> object contains 343 control points where the
<code>source</code> coordinates have been pre-aligned, so we can focus
on the residual <code>dx</code> and <code>dy</code> errors.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the built-in Swiss control points dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">swiss_cps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the data structure</span></span>
<span><span class="co"># Note that dx and dy are relatively small, representing the non-linear errors.</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">swiss_cps</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 343</span></span>
<span><span class="co">#&gt; Columns: 8</span></span>
<span><span class="co">#&gt; $ Index    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>5<span style="color: #949494;">, </span>6<span style="color: #949494;">, </span>7<span style="color: #949494;">, </span>8<span style="color: #949494;">, </span>9<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>11<span style="color: #949494;">, </span>12<span style="color: #949494;">, </span>13<span style="color: #949494;">, </span>14<span style="color: #949494;">, </span>15<span style="color: #949494;">, </span>16<span style="color: #949494;">, </span>17<span style="color: #949494;">, </span>18…</span></span>
<span><span class="co">#&gt; $ source_x <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 612293.0<span style="color: #949494;">, </span>612225.0<span style="color: #949494;">, </span>615470.3<span style="color: #949494;">, </span>616339.8<span style="color: #949494;">, </span>616927.1<span style="color: #949494;">, </span>617571.9<span style="color: #949494;">, </span>6…</span></span>
<span><span class="co">#&gt; $ source_y <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 267353.6<span style="color: #949494;">, </span>270412.7<span style="color: #949494;">, </span>270195.1<span style="color: #949494;">, </span>269367.5<span style="color: #949494;">, </span>269507.6<span style="color: #949494;">, </span>269273.5<span style="color: #949494;">, </span>2…</span></span>
<span><span class="co">#&gt; $ target_x <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 611375.9<span style="color: #949494;">, </span>611573.1<span style="color: #949494;">, </span>615840.8<span style="color: #949494;">, </span>616129.6<span style="color: #949494;">, </span>617031.0<span style="color: #949494;">, </span>618168.7<span style="color: #949494;">, </span>6…</span></span>
<span><span class="co">#&gt; $ target_y <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 267719.1<span style="color: #949494;">, </span>270370.6<span style="color: #949494;">, </span>270463.6<span style="color: #949494;">, </span>269380.6<span style="color: #949494;">, </span>268932.1<span style="color: #949494;">, </span>269179.3<span style="color: #949494;">, </span>2…</span></span>
<span><span class="co">#&gt; $ dx       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -917.1063<span style="color: #949494;">, </span>-651.9320<span style="color: #949494;">, </span>370.4737<span style="color: #949494;">, </span>-210.1946<span style="color: #949494;">, </span>103.8862<span style="color: #949494;">, </span>596.7662…</span></span>
<span><span class="co">#&gt; $ dy       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 365.468249<span style="color: #949494;">, </span>-42.050863<span style="color: #949494;">, </span>268.478200<span style="color: #949494;">, </span>13.144895<span style="color: #949494;">, </span>-575.530782<span style="color: #949494;">, </span>-…</span></span>
<span><span class="co">#&gt; $ geometry <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span> POINT (612293 267353.6)<span style="color: #949494;">, </span>POINT (612225 270412.7)<span style="color: #949494;">, </span>POINT…</span></span>
<span></span>
<span><span class="co"># Let's visualize the residual displacement vectors</span></span>
<span><span class="fu"><a href="../reference/plot_displacement.html">plot_displacement</a></span><span class="op">(</span><span class="va">swiss_cps</span>, title <span class="op">=</span> <span class="st">"Residual Non-Linear Distortions"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/swiss-load-data-1.png" width="100%"> The plot
shows that even after a global alignment, there are clear spatial
patterns in the remaining errors, which a simple linear model could not
fix.</p>
</div>
<div class="section level2">
<h2 id="step-2-create-a-reference-grid-to-deform">Step 2: Create a Reference Grid to Deform<a class="anchor" aria-label="anchor" href="#step-2-create-a-reference-grid-to-deform"></a>
</h2>
<p>To best visualize the distortion, we will create a regular grid of
lines that covers the extent of our control points. This will serve as
our “source map.” We will then apply our correction model to this grid
to see how it is “un-warped.”</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a grid of polygons covering the data extent</span></span>
<span><span class="va">grid_polygons</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span><span class="va">swiss_cps</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert the polygon boundaries to a MULTILINESTRING object</span></span>
<span><span class="co"># This gives us a clean line grid for visualization.</span></span>
<span><span class="va">source_grid</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="va">grid_polygons</span>, <span class="st">"MULTILINESTRING"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Convert to a full sf object</span></span>
<span></span>
<span><span class="co"># Plot the original, regular grid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">source_grid</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Original, Regular Reference Grid"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/swiss-create-grid-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="step-3-train-a-non-linear-model">Step 3: Train a Non-Linear Model<a class="anchor" aria-label="anchor" href="#step-3-train-a-non-linear-model"></a>
</h2>
<p>Because the linear components of the distortion have already been
removed from the <code>swiss_cps</code> data, using a
<code>helmert</code> or <code>lm</code> model would be ineffective. This
is the perfect scenario to use a <strong>Generalized Additive Model
(<code>gam</code>)</strong>, which is designed to capture exactly these
kinds of smooth, non-linear spatial patterns.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Train the GAM model to learn the residual distortion patterns</span></span>
<span><span class="va">gam_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_pai_model.html">train_pai_model</a></span><span class="op">(</span><span class="va">swiss_cps</span>, method <span class="op">=</span> <span class="st">"gam"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Training 'gam' model...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-4-apply-the-correction-to-the-grid">Step 4: Apply the Correction to the Grid<a class="anchor" aria-label="anchor" href="#step-4-apply-the-correction-to-the-grid"></a>
</h2>
<p>Now, we use our trained <code>gam_model</code> to correct the regular
line grid we created. The <code>apply_pai_model</code> function will
transform every vertex in the grid according to the learned
distortion.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply the model to our source grid</span></span>
<span><span class="va">corrected_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_pai_model.html">apply_pai_model</a></span><span class="op">(</span><span class="va">gam_model</span>, <span class="va">source_grid</span><span class="op">)</span></span>
<span><span class="co">#&gt; Applying PAI model to map features...</span></span>
<span><span class="co">#&gt; Correction complete.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-5-visualize-the-corrected-grid">Step 5: Visualize the Corrected Grid<a class="anchor" aria-label="anchor" href="#step-5-visualize-the-corrected-grid"></a>
</h2>
<p>This is the most intuitive part of the analysis. We overlay the
corrected grid on the original grid. The correction will transform the
regular, straight-lined grid to a warped one, in order to correct
it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For easy plotting, add a 'status' column to each grid</span></span>
<span><span class="va">source_grid</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="st">"Original (Regular)"</span></span>
<span><span class="va">corrected_grid</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="st">"Corrected (Warped by model)"</span></span>
<span></span>
<span><span class="co"># Combine them into a single sf object for ggplot2</span></span>
<span><span class="va">comparison_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">source_grid</span><span class="op">[</span>, <span class="st">"status"</span><span class="op">]</span>,</span>
<span>  <span class="va">corrected_grid</span><span class="op">[</span>, <span class="st">"status"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">comparison_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">status</span>, linetype <span class="op">=</span> <span class="va">status</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Grid Status"</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original (Regular)"</span> <span class="op">=</span> <span class="st">"grey50"</span>, </span>
<span>               <span class="st">"Corrected (Warped by model)"</span> <span class="op">=</span> <span class="st">"#e41a1c"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Grid Status"</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original (Regular)"</span> <span class="op">=</span> <span class="st">"dashed"</span>, </span>
<span>               <span class="st">"Corrected (Warped by model)"</span> <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Visualizing the Non-Linear Correction"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"The GAM model transforms the regular shape to warped grid"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/swiss-plot-correction-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="step-6-in-depth-distortion-analysis">Step 6: In-Depth Distortion Analysis<a class="anchor" aria-label="anchor" href="#step-6-in-depth-distortion-analysis"></a>
</h2>
<p>Finally, let’s use the advanced analysis functions to quantify the
distortion that the model learned. We will analyze the distortion on a
dense grid of points and visualize the results.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Create a dense grid of POINTS for analysis</span></span>
<span><span class="va">analysis_points</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span><span class="va">swiss_cps</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Analyze the distortion using our trained GAM model</span></span>
<span><span class="va">distortion_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyze_distortion.html">analyze_distortion</a></span><span class="op">(</span><span class="va">gam_model</span>, <span class="va">analysis_points</span><span class="op">)</span></span>
<span><span class="co">#&gt; Calculating distortion metrics for gam model...</span></span>
<span><span class="co">#&gt; Finalizing metrics from derivatives...</span></span>
<span><span class="co">#&gt; Distortion analysis complete.</span></span>
<span></span>
<span><span class="co"># 3. Visualize the results for two key metrics</span></span>
<span><span class="va">plot_shear</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_distortion_surface.html">plot_distortion_surface</a></span><span class="op">(</span></span>
<span>  <span class="va">distortion_results</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"max_shear"</span>,</span>
<span>  diverging <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"magma"</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Maximum Angular Distortion (°)"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regular grid detected. Creating a surface plot with geom_raster().</span></span>
<span></span>
<span><span class="va">plot_area</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_distortion_surface.html">plot_distortion_surface</a></span><span class="op">(</span></span>
<span>  <span class="va">distortion_results</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"log2_area_scale"</span>,</span>
<span>  diverging <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Log-Areal Distortion (log2)"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regular grid detected. Creating a surface plot with geom_raster().</span></span>
<span></span>
<span><span class="co"># Combine plots using the patchwork library</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"patchwork"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plot_shear</span> <span class="op">/</span> <span class="va">plot_area</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">plot_shear</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning: Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">#&gt; Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">#&gt; Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">#&gt; Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span></code></pre></div>
<p><img src="reference/figures/swiss-analysis-1.png" width="100%"></p>
<p>This final analysis provides a quantitative map of the distortion,
revealing complex patterns of shearing and scaling across the map extent
that the <code>gam</code> model successfully identified and
corrected.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Konstantinos Vantas.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
