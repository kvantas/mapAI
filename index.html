<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An R Package for Positional Accuracy Improvement of Historical Maps • mapAI</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="An R Package for Positional Accuracy Improvement of Historical Maps">
<meta name="description" content="An R package for Positional Accuracy Improvement of Historical Maps that uses supervised learning algorithms. It uses as input a csv file with homologous points and a vector map of the area of interest in order to correct it.">
<meta property="og:description" content="An R package for Positional Accuracy Improvement of Historical Maps that uses supervised learning algorithms. It uses as input a csv file with homologous points and a vector map of the area of interest in order to correct it.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">mapAI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/demo_data.html">Getting Started with mapAI: A Complete Workflow</a></li>
    <li><a class="dropdown-item" href="articles/pai_validation.html">Comparing PAI Methods and Validation Strategies</a></li>
    <li><a class="dropdown-item" href="articles/swiss_data.html">Advanced Analysis with Swiss Data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="mapai">mapAI<a class="anchor" aria-label="anchor" href="#mapai"></a>
</h1></div>
<!-- badges: start -->

<p>The <code>mapAI</code> package provides a cohesive, end-to-end toolkit in R for the <strong>Positional Accuracy Improvement (PAI)</strong> of historical vector maps. It uses modern machine learning and statistical models to learn the complex geometric distortions inherent in historical cartographic documents and applies a correction to improve their alignment with modern coordinate systems.</p>
<p>The package is designed for researchers and practitioners in geomatics and GIS who need to integrate historical maps into contemporary spatial analysis workflows.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The core workflow of <code>mapAI</code> involves:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Reading Data</strong>: Easily load your distorted map (<code>.shp</code>, etc.) and a corresponding set of homologous points (GCPs) from a CSV file.</li>
<li>
<strong>Training a Model</strong>: Use <code><a href="reference/train_pai_model.html">train_pai_model()</a></code> to train one of several correction models (<code>lm</code>, <code>rf</code>, <code>gam</code>, <code>helmert</code>) to learn the distortion pattern from your GCPs.</li>
<li>
<strong>Applying the Correction</strong>: Use <code><a href="reference/apply_pai_model.html">apply_pai_model()</a></code> to apply the trained model to every vertex of your historical map, generating a new, corrected <code>sf</code> object.</li>
<li>
<strong>Analyzing Distortion</strong>: Go beyond simple correction by using functions like <code><a href="reference/analyze_distortion.html">analyze_distortion()</a></code> and <code><a href="reference/plot_indicatrices.html">plot_indicatrices()</a></code> to perform a detailed differential distortion analysis based on Tissot’s indicatrix theory.</li>
</ol>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of mapAI from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"kvantas/mapAI"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>This example demonstrates the main workflow from start to finish. We will first generate a synthetic dataset representing a distorted map, and then use the package’s functions to correct it.</p>
<div class="section level3">
<h3 id="id_1-load-libraries-and-create-demo-data">1. Load Libraries and Create Demo Data<a class="anchor" aria-label="anchor" href="#id_1-load-libraries-and-create-demo-data"></a>
</h3>
<p>We begin by loading the necessary libraries and using <code><a href="reference/create_demo_data.html">create_demo_data()</a></code> to generate a test case. This function creates a distorted grid shapefile and a corresponding CSV file of control points in a temporary directory.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kvantas.github.io/mapAI/">mapAI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate a shapefile and a GCPs CSV with complex distortions</span></span>
<span><span class="co"># The function returns a list containing the paths to these new files.</span></span>
<span><span class="va">demo_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_demo_data.html">create_demo_data</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"complex"</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span><span class="co">#&gt;    -&gt; Homologous points saved to: /var/folders/yh/kq6cp_457lg059f3l02r57s80000gn/T//RtmpVVV9Ta/demo_gcps.csv</span></span>
<span><span class="co">#&gt;    -&gt; Distorted map saved to: /var/folders/yh/kq6cp_457lg059f3l02r57s80000gn/T//RtmpVVV9Ta/demo_map.shp</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_2-read-the-data-into-r">2. Read the Data into R<a class="anchor" aria-label="anchor" href="#id_2-read-the-data-into-r"></a>
</h3>
<p>Next, we use the package’s reading functions to load the files we just created. When using your own data, you would simply replace the file paths here with the paths to your own <code>.shp</code> and <code>.csv</code> files.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the homologous points (GCPs)</span></span>
<span><span class="co"># It is crucial to provide the correct Coordinate Reference System (CRS).</span></span>
<span><span class="va">gcp_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_gcps.html">read_gcps</a></span><span class="op">(</span>gcp_path <span class="op">=</span> <span class="va">demo_files</span><span class="op">$</span><span class="va">gcp_path</span>, crs <span class="op">=</span> <span class="fl">2100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the distorted vector map</span></span>
<span><span class="va">map_to_correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_map.html">read_map</a></span><span class="op">(</span>shp_path <span class="op">=</span> <span class="va">demo_files</span><span class="op">$</span><span class="va">shp_path</span>, crs <span class="op">=</span> <span class="fl">2100</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_3-train-a-correction-model">3. Train a Correction Model<a class="anchor" aria-label="anchor" href="#id_3-train-a-correction-model"></a>
</h3>
<p>We’ll train a <strong>Generalized Additive Model (<code>gam</code>)</strong>, which is an excellent choice as it is flexible enough to capture the complex, non-linear distortions in our demo data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Train the model using our GCPs</span></span>
<span><span class="va">gam_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/train_pai_model.html">train_pai_model</a></span><span class="op">(</span><span class="va">gcp_data</span>, method <span class="op">=</span> <span class="st">"gam"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Training 'gam' model...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_4-apply-the-model-to-correct-the-map">4. Apply the Model to Correct the Map<a class="anchor" aria-label="anchor" href="#id_4-apply-the-model-to-correct-the-map"></a>
</h3>
<p>Now we apply this trained model to our distorted grid. The function returns a new <code>sf</code> object with the corrected geometries.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply the model to the distorted map</span></span>
<span><span class="va">corrected_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/apply_pai_model.html">apply_pai_model</a></span><span class="op">(</span><span class="va">gam_model</span>, <span class="va">map_to_correct</span><span class="op">)</span></span>
<span><span class="co">#&gt; Applying PAI model to map features...</span></span>
<span><span class="co">#&gt; Correction complete.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_5-visualize-the-result">5. Visualize the Result<a class="anchor" aria-label="anchor" href="#id_5-visualize-the-result"></a>
</h3>
<p>The most effective way to see the result is to plot the corrected map overlaid on the original. The “warped” grid being transformed back into a regular grid provides a clear visual confirmation of the positional improvement.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For easy plotting, we add a 'status' column to each map</span></span>
<span><span class="va">map_to_correct</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="st">"Original (Distorted)"</span></span>
<span><span class="va">corrected_map</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="st">"Corrected"</span></span>
<span></span>
<span><span class="co"># Combine them into a single sf object for ggplot2</span></span>
<span><span class="va">comparison_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">map_to_correct</span><span class="op">[</span>, <span class="st">"status"</span><span class="op">]</span>,</span>
<span>  <span class="va">corrected_map</span><span class="op">[</span>, <span class="st">"status"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a plot comparing the original and corrected grids</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">comparison_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">status</span>, linetype <span class="op">=</span> <span class="va">status</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Map Status"</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original (Distorted)"</span> <span class="op">=</span> <span class="st">"grey50"</span>, <span class="st">"Corrected"</span> <span class="op">=</span> <span class="st">"#e41a1c"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Map Status"</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original (Distorted)"</span> <span class="op">=</span> <span class="st">"dashed"</span>, <span class="st">"Corrected"</span> <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Positional Correction of a Distorted Grid"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Overlay of original (dashed) and mapAI-corrected (solid) geometries"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example-plot-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="advanced-distortion-analysis">Advanced: Distortion Analysis<a class="anchor" aria-label="anchor" href="#advanced-distortion-analysis"></a>
</h2>
<p><code>mapAI</code> is more than just a correction tool. You can also perform a detailed analysis of the distortion itself. For example, you can analyze the maximum shear (<code>max_shear</code>) across the map and visualize it as a surface.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Create a grid of points for analysis using the pipe (%&gt;%)</span></span>
<span><span class="co">#    We need the magrittr package for the pipe if not loading dplyr.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="va">analysis_points</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span><span class="va">gcp_data</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Analyze the distortion using our trained GAM model</span></span>
<span><span class="va">distortion_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/analyze_distortion.html">analyze_distortion</a></span><span class="op">(</span><span class="va">gam_model</span>, <span class="va">analysis_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Plot the shear distortion surface</span></span>
<span><span class="fu"><a href="reference/plot_distortion_surface.html">plot_distortion_surface</a></span><span class="op">(</span></span>
<span>  <span class="va">distortion_results</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"max_shear"</span>,</span>
<span>  gcp_data <span class="op">=</span> <span class="va">gcp_data</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Maximum Shear Distortion (°)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-advanced-analysis-1.png" width="100%"> This shows how <code>mapAI</code> can be used for both practical correction and deeper analytical research into the properties of historical maps.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing mapAI</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Konstantinos Vantas <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-6387-8791" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://codecov.io/gh/kvantas/mapAI" class="external-link"><img src="https://codecov.io/gh/kvantas/mapAI/branch/master/graph/badge.svg?token=8dbGQrCCnz" alt="codecov"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://github.com/kvantas/mapAI/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/kvantas/mapAI/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Konstantinos Vantas.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
