% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_distortion_surface.R
\name{plot_distortion_surface}
\alias{plot_distortion_surface}
\title{Visualize a Distortion Metric}
\usage{
plot_distortion_surface(
  distortion_sf,
  metric,
  gcp_data = NULL,
  palette = "viridis",
  diverging = FALSE
)
}
\arguments{
\item{distortion_sf}{An \code{sf} object of \strong{points} returned by
\code{analyze_distortion()}.}

\item{metric}{A character string specifying the name of the metric column to
plot. Must be one of "a", "b", "area_scale", "log2_area_scale",
"max_shear", "max_angular_distortion", "airy_kavrayskiy", or "theta_a".}

\item{gcp_data}{An optional \code{sf} object of the original GCPs to overlay on
the plot for context.}

\item{palette}{A character string specifying the name of a viridis color
palette (e.g., "viridis", "magma", "cividis"), used when \code{diverging=FALSE}.}

\item{diverging}{A logical value. If \code{TRUE}, a diverging color scale is used,
which is ideal for metrics like \code{area_scale} or \code{log2_area_scale}.}
}
\value{
A \code{ggplot} object, which can be further customized.
}
\description{
Creates a visualization of a continuous distortion metric from
the output of \code{analyze_distortion()}.
}
\details{
This function visualizes the distortion field as it exists on the
\strong{source map's coordinate space}. This allows for a direct visual
correlation between features on the original map and the calculated
distortion metrics.
\itemize{
\item \strong{For points on a regular grid} (recommended): It creates a
rasterized surface plot using \code{geom_raster()}, which is ideal for
visualizing continuous distortion surfaces. To create a regular grid,
use the pattern: \code{sf::st_make_grid(...) \%>\% sf::st_centroid() \%>\% sf::st_sf()}.
\item \strong{For scattered, irregular points} (like the original GCPs):
It creates a point plot where each point is colored by its metric value.
This avoids memory errors and still provides a useful diagnostic plot,
along with a message recommending the use of a grid for a true surface
plot.
}

\strong{Interpreting Plots by Model Type}

The visual output will depend on the model used to generate the
\code{distortion_sf} data:
\itemize{
\item \strong{\code{gam} or \code{tps} model data}: Will produce a smooth, continuous
surface withcspatially varying colors, which is highly informative. This is
the idealcmodel for this function.
\item \strong{\code{helmert} or \code{lm} model data}: Will produce a plot with a single,
uniform color, as the underlying distortion metrics are constant across
the map.
\item \strong{\code{rf} model data}: Will produce a plot indicating an Identity
transformation (\code{area_scale} = 1, \code{max_shear} = 0). While RF might be an
excellent correction tool, this analysis is not informative for it.
}

You may see a benign warning from \code{ggplot2} about "uneven horizontal
intervals." This is caused by minor floating-point inaccuracies in the grid
coordinates and can be safely ignored; the plot is still accurate.
}
\examples{
# --- 1. Train a GAM model for the best visual results ---
library(magrittr)
data(swiss_cps)
gam_model <- train_pai_model(swiss_cps, pai_method = "gam")

# --- 2. Create a regular grid of POINTS for analysis ---
analysis_points <- sf::st_make_grid(swiss_cps, n = c(25, 25)) \%>\%
  sf::st_centroid() \%>\%
  sf::st_sf()

distortion_on_grid <- analyze_distortion(gam_model, analysis_points)

# --- 3. Plot a metric using a standard sequential scale ---
plot_distortion_surface(
  distortion_on_grid,
  metric = "max_shear",
  palette = "magma"
)

# --- 4. Plot a metric using a diverging scale ---
# 'log2_area_scale' is ideal for this, as it's centered at 0.
plot_distortion_surface(
  distortion_on_grid,
  metric = "log2_area_scale",
  diverging = TRUE
)

}
